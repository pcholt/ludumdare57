pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
player={
	x=4, y=8
}
depth_colors={12,13,5,1,0}
fraction_depth_bitmasks={
    0b0000000000000000,
    0b0000000100000000,
    0b0010000000001000,
    0b0001000001000010,
    0b1001001001001000,
    0b1010010110100101,
    0b1010110110110101,
    0b1010110110110101,
    0b1010110110110101,
    0b1110110110111101,
    0b1110111110111101,
    0b1110111110111111,
    0b1110111111111111,
}

function _draw()
    camera(player.x-60, player.y-60)
    cls()
    draw_borders()
    draw_depth_overlay()
    map()
    draw_player()
end

function vacant(x,y)
    return x >= 0 and x <= 127*8-1 and y >= 8 and y <= 63*8-1 and mget(x/8, y/8) ~= 1
end

function _update()
    local x,y = player.x, player.y
    local speed = 7

    if not btn(2) and vacant(x,y+8) and vacant(x+7,y+8) and y<16 then
        y = y + 1
    end
    
    if (btn(0) and vacant(x-1,y) and vacant(x-1,y+7)) x = x - speed
    if (btn(1) and vacant(x+8,y) and vacant(x+8,y+7)) x = x + speed
    if (btn(2) and vacant(x,y-1) and vacant(x+7,y-1)) y = y - speed
    if (btn(3) and vacant(x,y+8) and vacant(x+7,y+8)) y = y + speed

    player.x,player.y = x,y
end

function draw_player()
    spr(4, player.x, player.y)
end

function draw_borders()
    local mask=0b1010010110100101
    fillp(mask)
    rectfill(-127, 15, 127*64+64, -63, 12 + 7*16)
    fillp(0)
    rectfill(-127, 16, 0, 64*8, 10)
end

function draw_depth_overlay()
    for depth = 0,63 do
        local i = flr(depth/13) + 1
        local colour = depth_colors[i]
        local colour2 = depth_colors[i+1]
        if not colour2 then
            colour2 = colour
        end
        local partial = fraction_depth_bitmasks[depth % 13 + 1]
        fillp(partial)
        rectfill(0, depth*8+16, 127*8, depth*8 + 16 + 8, colour + 16 * colour2)
    end
end

__gfx__
00000000aaaaaaaa7c7c7c7c00000600000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaac7c7c7c700000500000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aaaaaaaa7c7c7c7c07766660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaaaaaac7c7c7c766666666009999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaaaaaa7c7c7c7c6dddddd6090990900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aaaaaaaac7c7c7c705555550090990900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7c7c7c7cdd0000dd000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaac7c7c7c7d000000d000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10101010101010101010101010101010101010101010000000000000000000000000000000000000101010101010101010101010101010101010101010101010
10101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010
10101010101010101010101010101010101010101010000000000000000000000000000000000000101010101010101010101010101010101010101010101010
10101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010
10101010101010101010101010101010101010101010000000000000000000000000000000000000101010101010101010101010101010101010101010101010
10101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010
10101010101010101010101010101010101010101010000000000000000000000000000000000000101010101010101010101010101010101010101010101010
10101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101000001010
10101010101010101010101010101010101010101010000000000000000000000000000000000000101010101010101010101010101010101010101010101010
10101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101000000010
10101010101010101010101010101010101010101010000000000000000000000000000000000010101010101010101010101010101010101010101010101010
10101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000001010101010100000000000
10101010101010101010101010101010101010101010000000000000000000000000000000000010101010101010101010101010101010101010101010101010
10101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000101010101010100000000000
10101010101010101010101010101010101010101010000000000000000000000000000000000010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000101010101010000000000010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000101010101000000000001010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000101010100000000000001010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010
10101010100010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010
10101000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010
10101000000010101010101010101010101010101010101000001010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000001010101010
10101000000000101010101010101010101010000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000001010101010
10100000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000010101010101010
10100000000000000000000000000000000000000000000000000000001010101010101010101010101010100000000000101010101010101010101010101010
10101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000001010101000000010101010101010101010
10100000000000000000000000000000000000000000000000000000000010101010101010101010101000000000000000000000000000001010101010101010
10101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000101010101010101010101010101010101010
10100000000000000000000000000000000000000000000000000000000000001010101010101010100000000000000000000000000000000000001010101010
10101010101010101010101010101010101010101010101000000000000000000000000000000000000000001010101010101010101010101010101010101010
10100000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000000000000000000000101010
10101010101010101010101010101010101010101010101000000000000000000000000000000000001010101010101010101010101010101010101010101010
10100000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000001010
10101010101010101010101010101010101010101010101000000000000000000000000000000000101010101010101010101010101010101010101010101010
10101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010
10101010101010000000000000001010101010101010000000000000000000000000000000001010101010101010101010101010101010101010101010101010
10101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000010101010101000000000000000000000000000000000101010101010101010101010101010101010101010101010101010
10101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000101010101000000000000000000000000000001010101010101010101010101010101010101010101010101010101010
10101000000000000000000000000000000000000000101010101010100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010
10101010000000000000000000000000000000101010101010101010101010101010000000001010101010101010101010101010101010101010101010101010
10101010101010100000000000000000000000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
0101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101010101010000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101
0101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101
0101010101010101010100000101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010101
0101010101010101010100000101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101
0101010101010101010100000101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010101010101
0101010101010101010100000101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101
0101010101010101010100000101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101
0101010101010101010100000101010101010101010101010101010101010101010000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101
0101010101010101010100000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101
0101010101000000000000000101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010000000000000001010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010100000000000000000000000000000000000101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010100000000000000000000000000000000000101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010100000000000000000000000000000000000101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010100000000000000000000000000000000000101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010100000000000000000000000000000000000001010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101
0101010101010101010101010101010101010101010100000000000000000000000000000000000001010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101
